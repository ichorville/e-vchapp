<mat-card class="p-0" style="margin:0px;">
	<mat-card-title>
		<div class="card-title-text">
			<mat-form-field>
				<mat-select placeholder="Product Code" 
					[formControl]="proCodeControl" 
					required 
					(change)="onChange($event)">
					<mat-option>--</mat-option>
					<mat-option *ngFor="let code of productCodes" [value]="code" >
						{{ code.name }}
					</mat-option>
				</mat-select>
				<mat-error *ngIf="proCodeControl.hasError('required')">Please choose a Product Code</mat-error>
			</mat-form-field>
			<span fxflex></span>
			<div class="upload-btn-wrapper" matTooltip="Upload File"
				style="padding-top: 16px;">
				<button class="file-upload" mat-icon-button>
					<mat-icon>file_upload</mat-icon>
				</button>
				<input 
					type="file"
					ng2FileSelect
					multiple 
					(onFileSelected)="selected($event)"
					[disabled]="!isSelected"
					[uploader]="uploader"/>
			</div>
		</div>
	</mat-card-title>
	<mat-card-content>
		<div class="mb-1" *ngIf="isSelected">
			<div ng2FileDrop
				[ngClass]="{'dz-file-over': hasBaseDropZoneOver}"
				(fileOver)="fileOverBase($event)"
				(onFileDrop)="dropped($event)"
				[uploader]="uploader"
				class="fileupload-drop-zone">
				Drop File Here
			</div>
		</div>

		<div *ngFor="let element of uploadElements">
			<div *ngIf="element.uploader.queue.length > 0">
				<div class="card-title-text" style="display: flex;">
					<h3 style="display: contents;">{{ element.code }}</h3>
					<span style ="flex: 1 1 auto;" fxflex></span>
					<button
						mat-raised-button
						style="margin-right: 3px;"
						class="mat-primary"
						(click)="element.uploader.uploadAll()" 
						[disabled]="!uploader.getNotUploadedItems().length">
						Upload All
					</button>
					<button
						mat-raised-button
						style="margin-right: 3px;"
						class="mat-accent"
						(click)="element.uploader.cancelAll()"
						[disabled]="!element.uploader.isUploading">
						Cancel All
					</button>
					<button
						style="margin-right: 23px;"
						mat-raised-button
						class="mat-warn"
						(click)="element.uploader.clearQueue()"
						[disabled]="!element.uploader.queue.length">
						Remove All
					</button>
				</div>
				<table class="default-table mat-box-shadow" style="width: 100%;">
					<thead>
						<tr>
							<th width="30%">Name</th>
							<th>Size</th>
							<th>Progress</th>
							<th>Status</th>
							<th style="text-align:right;padding-right:23px;">Actions</th>
						</tr>
					</thead>
					<tbody *ngIf="element.uploader.queue.length; else tableNoData">
						<tr *ngFor="let item of element.uploader.queue">
							<td>{{ item?.file?.name }}</td>
							<td nowrap>{{ item?.file?.size/1024/1024 | number:'.2' }} MB</td>
							<td>
								<div class="progress" style="margin-bottom: 0;">
									<div class="progress-bar" role="progressbar" [ngStyle]="{'width': item.progress + '%'}"></div>
									<mat-progress-bar
										color="primary"
										mode="determinate"
										[value]="item.progress">
									</mat-progress-bar>
								</div>
							</td>
							<td>
								<mat-icon *ngIf="item.isSuccess">check</mat-icon>
								<mat-icon *ngIf="item.isCancel">cancel</mat-icon>
								<mat-icon *ngIf="item.isError">error</mat-icon>
							</td>
							<td nowrap style="text-align:right;">
								<button
									mat-raised-button
									class="mat-primary"
									(click)="item.upload()"
									[disabled]="item.isReady || item.isUploading || item.isSuccess">
									Upload
								</button>
								<button
									mat-raised-button
									class="mat-accent"
									(click)="item.cancel()"
									[disabled]="!item.isUploading">
									Cancel
								</button>
								<button
									mat-raised-button
									class="mat-warn"
									(click)="item.remove()">
									Remove
								</button>
							</td>
						</tr>
					</tbody>
					<ng-template #tableNoData>
						<p [ngStyle]="{padding: '0 1.2rem'}"></p>
					</ng-template>
				</table>
		
				<div>
					<p style="margin: 16px 0 16px;">Queue Progress:</p>
					<div class="progress mb-1">
						<mat-progress-bar
							color="primary"
							mode="determinate"
							[value]="element.uploader.progress">
						</mat-progress-bar>
					</div>
					
				</div>
			</div>
		</div>
	</mat-card-content>
</mat-card>